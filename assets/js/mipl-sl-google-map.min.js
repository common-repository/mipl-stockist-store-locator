var $mipl_stockist_google_map=null,$mipl_mapl_markers={},activeInfoWindow=null,$mipl_map_circle=null,$mipl_sl_cl_markers=null,$centres_map_bounds=null;function mipl_sl_init_map(){$map_settings=$MIPL_SL_MAP_SETTINGS,$default_zoom=parseInt($map_settings.default_zoom),""==$default_zoom&&($default_zoom=4);var e=parseFloat($map_settings.default_location[0]),t=parseFloat($map_settings.default_location[1]);if(""==$map_settings.default_location&&(e=18.51935992967428,t=73.85625782990782),""==$map_settings.map_type&&($map_settings.map_type="roadmap"),"template11"==$map_settings.layout||"template10"==$map_settings.layout)var o={position:google.maps.ControlPosition.LEFT_BOTTOM},a=!0,l={position:google.maps.ControlPosition.LEFT_BOTTOM};var i="";""!=$map_settings.map_style&&(i=JSON.parse(atob($map_settings.map_style))),$mipl_stockist_google_map=new google.maps.Map(document.getElementById("mipl_sl_stockist_map"),{zoom:$default_zoom,center:{lat:e,lng:t},mapTypeId:$map_settings.map_type,disableDefaultUI:$map_settings.map_controller,zoomControl:!0,styles:i,zoomControlOptions:o,streetViewControl:a,streetViewControlOptions:l});var _=jQuery(".mipl_sl_stockist").attr("data-open_info_window");jQuery(".mipl_sl_stockist").on(_,".mipl_sl_stockist_item",(function(e){if("mipl_sl_listing_text"==e.target.className)return!0;var t=jQuery(this).attr("data-store_id");new google.maps.event.trigger($mipl_mapl_markers[t],"click")}))}function mipl_map_get_geolocation(e,t){(new google.maps.Geocoder).geocode({location:e},(function(e,o){if("OK"==o&&e.length>0){var a=e[0],l=mipl_sl_get_formated_address(a.address_components),i=a.geometry.location.lat(),_=a.geometry.location.lng();t({address:l,latitude:i,longitude:_})}}))}function mipl_map_update_map_markers(e){for(var t in $map_settings=$MIPL_SL_MAP_SETTINGS,$mipl_mapl_markers)void 0!==$mipl_mapl_markers[t]&&$mipl_mapl_markers[t].setMap(null);null!=$mipl_sl_cl_markers&&$mipl_sl_cl_markers.clearMarkers(),$window_event=$map_settings.open_info_window,""==$window_event&&($window_event="click"),$centres_map_bounds=new google.maps.LatLngBounds,jQuery(".mipl_sl_stockist_listing .mipl_sl_stockist_item").each((function(){var e=jQuery(this).attr("data-store_id"),t=parseFloat(jQuery(this).attr("data-store_latitude")),o=parseFloat(jQuery(this).attr("data-store_longitude")),a=miplsl_get_infowindow_content(this),l={lat:t,lng:o};new google.maps.InfoWindow;$centres_map_bounds.extend(l);var i="";null!=$map_settings.store_map_pin&&(i={url:$map_settings.store_map_pin}),$mipl_mapl_markers[e]=new google.maps.Marker({position:l,map:$mipl_stockist_google_map,animation:google.maps.Animation.DROP,icon:i,title:jQuery(this).find(".mipl_sl_store_title").text()}),google.maps.event.addListener($mipl_mapl_markers[e],"mouseover",(function(){$mipl_mapl_markers[e].setAnimation(google.maps.Animation.BOUNCE)})),google.maps.event.addListener($mipl_mapl_markers[e],"mouseout",(function(){$mipl_mapl_markers[e].setAnimation(null)}));var _=new google.maps.InfoWindow;google.maps.event.addListener($mipl_stockist_google_map,"click",function(e){return function(){e.close()}}(_));var s,n,r=!1;google.maps.event.addListener($mipl_stockist_google_map,"bounds_changed",(function(){r||google.maps.event.addListener($mipl_mapl_markers[e],"click",(function(){mipl_sl_offsetCenter($mipl_mapl_markers[e].getPosition(),0,-120),r=!0}))})),google.maps.event.addListener($mipl_mapl_markers[e],$window_event,(s=$mipl_mapl_markers[e],n=a,function(){google.maps.event.trigger($mipl_stockist_google_map,"click"),_.setContent(n),_.open($mipl_stockist_google_map,s)}))})),$mipl_sl_center=$mipl_stockist_google_map.getCenter();var o={lat:$mipl_sl_center.lat(),lng:$mipl_sl_center.lng()};$centres_map_bounds.extend(o);var a=$centres_map_bounds.getNorthEast().lat()-$centres_map_bounds.getSouthWest().lat();if($map_settings.zoom_as_per_the_map_pins&&""!=$map_settings.zoom_as_per_the_map_pins&&a>0&&$mipl_stockist_google_map.fitBounds($centres_map_bounds),mipl_sl_update_map_circle(),null==$mipl_sl_cl_markers){if(""==$map_settings.markerclusterer||0==$map_settings.markerclusterer)return!1;$mipl_sl_cl_markers=new markerClusterer.MarkerClusterer({map:$mipl_stockist_google_map,markers:Object.values($mipl_mapl_markers)})}}function mipl_sl_offsetCenter(e,t,o){var a=Math.pow(2,$mipl_stockist_google_map.getZoom()),l=$mipl_stockist_google_map.getProjection().fromLatLngToPoint(e),i=new google.maps.Point(t/a||0,o/a||0),_=new google.maps.Point(l.x-i.x,l.y+i.y),s=$mipl_stockist_google_map.getProjection().fromPointToLatLng(_);$mipl_stockist_google_map.setCenter(s,!0)}function mipl_sl_autocomplete_place(){if(jQuery("#mipl_sl_current_location").length>0){var e=new google.maps.places.Autocomplete(document.getElementById("mipl_sl_current_location"));google.maps.event.addListener(e,"place_changed",(function(){var t=e.getPlace(),o=mipl_sl_get_formated_address(t.address_components),a=t.geometry.location.lat(),l=t.geometry.location.lng();return mipl_sl_save_current_location({address:o,latitude:a,longitude:l}),!1}))}}function mipl_sl_get_formated_address(e){var t=["sublocality","locality","administrative_area_level_2","administrative_area_level_1","country","postal_code"],o=[];for(i=0;i<e.length;++i){var a=e[i].types;for(var l in t){var _=t[l];a.indexOf(_)>-1&&o.push(e[i].long_name)}}var s=o.filter((function(e,t,o){return t==o.indexOf(e)}));return $formated_address=s.join(", "),$formated_address}function mipl_map_update_current_location_marker(e){$map_settings=$MIPL_SL_MAP_SETTINGS;var t=parseFloat(e.latitude),o=parseFloat(e.longitude),a={lat:t,lng:o};$mipl_stockist_google_map.setCenter({lat:t,lng:o}),$marker_icon={url:$map_settings.curr_loc_map_pin},"undefined"!=typeof $mipl_current_location&&$mipl_current_location.setMap(null),$mipl_current_location=new google.maps.Marker({position:a,title:"Current Location",map:$mipl_stockist_google_map,animation:google.maps.Animation.DROP,icon:$marker_icon}),mipl_sl_update_map_circle()}function mipl_sl_update_map_circle(){if(o=a="",""==$map_settings.radius_circle||0==$map_settings.radius_circle)return!1;if(null!=$mipl_map_circle&&$mipl_map_circle.setMap(null),0==jQuery("#mipl_sl_distance").length||""==jQuery("#mipl_sl_distance").val().trim())return!1;var e=parseInt(jQuery("#mipl_sl_distance").val()),t=localStorage.getItem("mipl_sl_current_location");if(t){t=JSON.parse(t);var o=parseFloat(t.latitude),a=parseFloat(t.longitude)}$mipl_map_circle=new google.maps.Circle({strokeColor:"#FF0000",strokeOpacity:.8,strokeWeight:2,fillColor:"#FF0000",fillOpacity:.35,map:$mipl_stockist_google_map,center:{lat:o,lng:a},radius:1e3*e})}jQuery(document).ready((function(){jQuery(".mipl_sl_stockist ").on("mouseover",".mipl_sl_stockist_item",(function(e){e.preventDefault();var t=jQuery(this).attr("data-store_id");new google.maps.event.trigger($mipl_mapl_markers[t],"mouseover")})),jQuery(".mipl_sl_stockist ").on("mouseout",".mipl_sl_stockist_item",(function(e){e.preventDefault();var t=jQuery(this).attr("data-store_id");new google.maps.event.trigger($mipl_mapl_markers[t],"mouseout")}))}));